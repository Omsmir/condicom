{
    "sourceFile": "frontend/app/api/auth/[...nextauth]/route.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1739030240877,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1739030240877,
            "name": "Commit-0",
            "content": "import NextAuth, { AuthOptions } from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport axios from \"axios\";\r\nimport jwt, { JwtPayload } from \"jsonwebtoken\";\r\nimport { JWT } from \"next-auth/jwt\";\r\nimport { cookies } from \"next/headers\";\r\nimport { UserInformation } from \"@/types\";\r\n\r\nconst authOptions: AuthOptions = {\r\n\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: \"Credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"text\" },\r\n        password: { label: \"Password\", type: \"password\" },\r\n      },\r\n      authorize: async (credentials) => {\r\n        try {\r\n          const response = await axios.post(\r\n            \"http://localhost:8080/api/auth/login\",\r\n            {\r\n              email: credentials?.email,\r\n              password: credentials?.password,\r\n            }\r\n          );\r\n\r\n          const { token } = response.data;\r\n\r\n          if (token) {\r\n            // Decode the JWT token\r\n            const decodedToken = jwt.decode(token) as JwtPayload;\r\n\r\n            // Return the user object\r\n\r\n            return {\r\n              email: credentials?.email,\r\n              id: decodedToken.id,\r\n              role: decodedToken.role,\r\n              name: decodedToken.name,\r\n              profileImg: decodedToken.profileImg,\r\n              verified: decodedToken.verified,\r\n              expires: decodedToken.expires,\r\n              code:decodedToken.code,\r\n              token,\r\n            };\r\n          }\r\n          return null; // Return null if no token is found\r\n        } catch (error: any) {\r\n          console.error(\"Login Error:\", error.response?.data || error.message);\r\n\r\n          if (error.response) {\r\n            const { status, data } = error.response;\r\n            if (status === 401) throw new Error(\"Invalid email or password.\");\r\n            if (status === 403)\r\n              throw new Error(data?.msg || \"Access forbidden.\");\r\n            throw new Error(data?.msg || \"An unexpected error occurred.\");\r\n          }\r\n\r\n          throw new Error(\"Unable to connect to the server.\");\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }: { token: JWT; user: any }) {\r\n      if (user) {\r\n        token.id = user.id;\r\n        token.role = user.role;\r\n        token.name = user.name;\r\n        token.token = user.token;\r\n        token.profileImg = user.profileImg;\r\n        token.verified = user.verified;\r\n        token.code = user.code\r\n      }\r\n\r\n      return token;\r\n    },\r\n    async session({ session, token }) {\r\n      // const response = await fetch(`http://localhost:8080/api/auth/${token.id}`)\r\n      // const data = await response.json() \r\n      // const user = data.existingUser as UserInformation\r\n      if (token) {\r\n        session.user = {\r\n          ...session.user,\r\n          id: token.id,\r\n          role: token.role,\r\n          image: token.profileImg as string,\r\n          name: token.name,\r\n          verified: token.verified,\r\n          code:token.code\r\n        };\r\n      }\r\n      console.log(session);\r\n      return session;\r\n    },\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n\r\nconst handler = NextAuth(authOptions);\r\n\r\n// Correctly export as HTTP methods\r\nexport { handler as GET, handler as POST };\r\n"
        }
    ]
}